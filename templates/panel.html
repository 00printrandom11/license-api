<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ§  END-GAME License Control Center</title>

<style>
:root{
--bg:#0a0e13;
--card:#161b22;
--card-hover:#1c2128;
--border:#30363d;
--text:#e6edf3;
--text-dim:#8b949e;
--green:#2ecc71;
--red:#e74c3c;
--blue:#3498db;
--orange:#f39c12;
--purple:#9b59b6;
--yellow:#f1c40f;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
background:linear-gradient(135deg,#0a0e13 0%,#05070a 100%);
color:var(--text);
font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
padding:0;
min-height:100vh;
}

.header{
background:linear-gradient(135deg,#161b22,#0d1117);
border-bottom:2px solid var(--border);
padding:20px 30px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 4px 20px rgba(0,0,0,.5);
position:sticky;
top:0;
z-index:1000;
}

.header h1{
font-size:24px;
display:flex;
align-items:center;
gap:12px;
}

.header-actions{
display:flex;
gap:15px;
align-items:center;
}

.container{
max-width:1600px;
margin:0 auto;
padding:25px;
}

.card{
background:var(--card);
border:1px solid var(--border);
border-radius:12px;
padding:20px;
margin-bottom:20px;
box-shadow:0 2px 15px rgba(0,0,0,.3);
transition:all .3s;
}

.card:hover{
border-color:#444c56;
box-shadow:0 4px 25px rgba(0,0,0,.4);
}

.metrics{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:15px;
margin-bottom:25px;
}

.metric-card{
background:linear-gradient(135deg,var(--card),var(--card-hover));
border:1px solid var(--border);
border-radius:12px;
padding:20px;
text-align:center;
transition:all .3s;
cursor:default;
}

.metric-card:hover{
transform:translateY(-3px);
box-shadow:0 6px 25px rgba(0,0,0,.4);
}

.metric-value{
font-size:36px;
font-weight:700;
margin:10px 0;
}

.metric-label{
color:var(--text-dim);
font-size:13px;
text-transform:uppercase;
letter-spacing:1px;
}

input,select,textarea{
width:100%;
padding:12px 15px;
background:#0d1117;
border:1px solid var(--border);
border-radius:8px;
color:var(--text);
font-size:14px;
transition:all .2s;
}

input:focus,select:focus,textarea:focus{
outline:none;
border-color:var(--blue);
box-shadow:0 0 0 3px rgba(52,152,219,.2);
}

.btn{
padding:10px 18px;
border-radius:8px;
border:none;
cursor:pointer;
font-size:13px;
font-weight:600;
transition:all .2s;
display:inline-flex;
align-items:center;
gap:6px;
text-decoration:none;
}

.btn:hover{
transform:translateY(-2px);
box-shadow:0 4px 12px rgba(0,0,0,.3);
}

.btn:active{
transform:translateY(0);
}

.btn-blue{background:var(--blue);color:white}
.btn-green{background:var(--green);color:white}
.btn-red{background:var(--red);color:white}
.btn-purple{background:var(--purple);color:white}
.btn-orange{background:var(--orange);color:white}
.btn-yellow{background:var(--yellow);color:#000}

.btn-sm{
padding:6px 12px;
font-size:12px;
}

.table-container{
overflow-x:auto;
}

table{
width:100%;
border-collapse:collapse;
font-size:13px;
}

th{
background:#21262d;
padding:15px 12px;
text-align:left;
font-size:12px;
text-transform:uppercase;
letter-spacing:.5px;
color:var(--text-dim);
border-bottom:2px solid var(--border);
white-space:nowrap;
}

td{
padding:15px 12px;
border-bottom:1px solid var(--border);
}

tbody tr{
transition:background .2s;
}

tbody tr:hover{
background:rgba(255,255,255,.03);
}

.badge{
padding:6px 12px;
border-radius:999px;
font-size:11px;
font-weight:700;
display:inline-block;
text-transform:uppercase;
letter-spacing:.3px;
}

.badge-green{background:var(--green);color:#000}
.badge-red{background:var(--red);color:white}
.badge-orange{background:var(--orange);color:#000}
.badge-purple{background:var(--purple);color:white}
.badge-blue{background:var(--blue);color:white}
.badge-yellow{background:var(--yellow);color:#000}

.pulse{
animation:pulse 2s infinite;
}

@keyframes pulse{
0%{box-shadow:0 0 0 0 rgba(46,204,113,.7)}
50%{box-shadow:0 0 0 10px rgba(46,204,113,0)}
100%{box-shadow:0 0 0 0 rgba(46,204,113,0)}
}

.actions{
display:flex;
gap:5px;
flex-wrap:wrap;
}

.toolbar{
display:flex;
gap:15px;
margin-bottom:20px;
flex-wrap:wrap;
}

.search-box{
flex:1;
min-width:250px;
position:relative;
}

.search-box input{
padding-left:40px;
}

.search-icon{
position:absolute;
left:12px;
top:50%;
transform:translateY(-50%);
color:var(--text-dim);
font-size:18px;
}

.modal{
position:fixed;
inset:0;
background:rgba(0,0,0,.8);
backdrop-filter:blur(5px);
display:none;
align-items:center;
justify-content:center;
z-index:9999;
padding:20px;
}

.modal-content{
background:var(--card);
border:1px solid var(--border);
border-radius:16px;
padding:30px;
max-width:500px;
width:100%;
box-shadow:0 10px 60px rgba(0,0,0,.8);
animation:modalSlide .3s ease;
}

@keyframes modalSlide{
from{opacity:0;transform:translateY(-30px)}
to{opacity:1;transform:translateY(0)}
}

.modal h3{
margin-bottom:20px;
font-size:20px;
}

.form-group{
margin-bottom:15px;
}

.form-group label{
display:block;
margin-bottom:8px;
color:var(--text-dim);
font-size:13px;
font-weight:600;
}

.log-item{
background:#0d1117;
border:1px solid var(--border);
border-radius:8px;
padding:12px 15px;
margin-bottom:10px;
font-size:12px;
display:flex;
justify-content:space-between;
align-items:center;
}

.log-item:hover{
background:#161b22;
}

.log-action{
font-weight:700;
color:var(--blue);
}

.log-time{
color:var(--text-dim);
font-size:11px;
}

.tabs{
display:flex;
gap:10px;
margin-bottom:20px;
border-bottom:2px solid var(--border);
}

.tab{
padding:12px 20px;
background:transparent;
border:none;
color:var(--text-dim);
cursor:pointer;
font-size:14px;
font-weight:600;
border-bottom:2px solid transparent;
margin-bottom:-2px;
transition:all .2s;
}

.tab:hover{
color:var(--text);
}

.tab.active{
color:var(--blue);
border-bottom-color:var(--blue);
}

.tab-content{
display:none;
}

.tab-content.active{
display:block;
}

.code{
font-family:'Courier New',monospace;
background:#0d1117;
padding:4px 8px;
border-radius:4px;
font-size:12px;
}

@media(max-width:768px){
.header{
flex-direction:column;
gap:15px;
}

.metrics{
grid-template-columns:repeat(2,1fr);
}

table{
font-size:11px;
}

th,td{
padding:10px 8px;
}

.actions{
flex-direction:column;
}

.btn{
width:100%;
justify-content:center;
}
}
</style>
</head>

<body>

<div class="header">
<h1>ğŸ§  END-GAME Control Center</h1>
<div class="header-actions">
<span style="color:var(--text-dim);font-size:13px">Admin Panel</span>
<a href="/panel/logout" class="btn btn-red btn-sm">ğŸšª Ã‡Ä±kÄ±ÅŸ</a>
</div>
</div>

<div class="container">

<div class="metrics">
<div class="metric-card">
<div class="metric-label">Toplam Lisans</div>
<div class="metric-value" style="color:var(--blue)">{{ metrics.total }}</div>
</div>
<div class="metric-card">
<div class="metric-label">Åu An Aktif</div>
<div class="metric-value" style="color:var(--green)">{{ metrics.active_now }}</div>
</div>
<div class="metric-card">
<div class="metric-label">BanlÄ± Lisans</div>
<div class="metric-value" style="color:var(--red)">{{ metrics.banned }}</div>
</div>
<div class="metric-card">
<div class="metric-label">BanlÄ± HWID</div>
<div class="metric-value" style="color:var(--purple)">{{ metrics.banned_hwids }}</div>
</div>
</div>

<div class="tabs">
<button class="tab active" onclick="switchTab('licenses')">ğŸ“‹ Lisanslar</button>
<button class="tab" onclick="switchTab('create')">â• Yeni Lisans</button>
<button class="tab" onclick="switchTab('banned')">ğŸš« BanlÄ± HWID'ler ({{ metrics.banned_hwids }})</button>
<button class="tab" onclick="switchTab('logs')">ğŸ“Š Audit Logs</button>
</div>

<div id="tab-licenses" class="tab-content active">

<div class="toolbar">
<div class="search-box">
<span class="search-icon">ğŸ”</span>
<input id="search" type="text" placeholder="Key, HWID, IP, Not ara...">
</div>
</div>

<div class="card">
<div class="table-container">
<table id="licenseTable">
<thead>
<tr>
<th>ID</th>
<th>KEY</th>
<th>HWID</th>
<th>SON KONTROL</th>
<th>DURUM</th>
<th>BÄ°TÄ°Å</th>
<th>KALAN</th>
<th>IP</th>
<th>ABUSE</th>
<th>NOT</th>
<th>Ä°ÅLEMLER</th>
</tr>
</thead>
<tbody>
{% for lic in licenses %}
<tr>
<td><strong>#{{ lic.id }}</strong></td>

<td>
<span class="code">{{ lic.license_key }}</span>
<button class="btn btn-purple btn-sm" onclick="copyText('{{ lic.license_key }}')">ğŸ“‹</button>
</td>

<td>
{% if lic.hwid %}
<span class="code" title="{{ lic.hwid }}">{{ lic.hwid[:16] }}...</span>
{% else %}
<span style="color:var(--text-dim)">-</span>
{% endif %}
</td>

<td>
{% if lic.last_check_at %}
{{ lic.last_check_at.strftime('%d.%m %H:%M:%S') }}
{% else %}
<span style="color:var(--text-dim)">HiÃ§</span>
{% endif %}
</td>

<td>
{% if lic.is_banned %}
<span class="badge badge-red">BANLI</span>
{% elif lic.last_check_at and (now - lic.last_check_at).total_seconds() < 60 %}
<span class="badge badge-green pulse">Ã‡ALIÅIYOR</span>
{% elif lic.is_active %}
<span class="badge badge-blue">AKTÄ°F</span>
{% else %}
<span class="badge badge-red">PASÄ°F</span>
{% endif %}
</td>

<td>
{% if lic.expiry_date %}
{{ lic.expiry_date.strftime('%d.%m.%Y %H:%M') }}
{% else %}
<span style="color:var(--text-dim)">-</span>
{% endif %}
</td>

<td>
{% if lic.expiry_date %}
{% set sec = (lic.expiry_date - now).total_seconds() %}
{% if sec > 0 %}
{% set days = (sec // 86400) | int %}
{% set hours = ((sec % 86400) // 3600) | int %}
{% set mins = ((sec % 3600) // 60) | int %}
{% if days > 0 %}
<strong>{{ days }}g {{ hours }}s</strong>
{% elif hours > 0 %}
<strong>{{ hours }}s {{ mins }}dk</strong>
{% else %}
<strong>{{ mins }}dk</strong>
{% endif %}
{% else %}
<span class="badge badge-red">DOLDU</span>
{% endif %}
{% else %}
<span style="color:var(--text-dim)">-</span>
{% endif %}
</td>

<td>
{% if lic.client_ip %}
<span class="code" style="font-size:11px">{{ lic.client_ip }}</span>
{% else %}
<span style="color:var(--text-dim)">-</span>
{% endif %}
</td>

<td>
{% if lic.abuse_score > 0 %}
<span class="badge badge-orange">{{ lic.abuse_score }}</span>
{% else %}
<span style="color:var(--text-dim)">0</span>
{% endif %}
</td>

<td>
{% if lic.note %}
{{ lic.note[:30] }}{% if lic.note|length > 30 %}...{% endif %}
{% else %}
<span style="color:var(--text-dim)">-</span>
{% endif %}
</td>

<td>
<div class="actions">
<button class="btn btn-blue btn-sm" onclick="openTimeModal({{ lic.id }})">â± SÃ¼re</button>

<form action="/panel/licenses/{{ lic.id }}/toggle" method="post" style="display:inline">
<button class="btn btn-sm {% if lic.is_active %}btn-orange{% else %}btn-green{% endif %}">
{% if lic.is_active %}â¸ Durdur{% else %}â–¶ BaÅŸlat{% endif %}
</button>
</form>

<form action="/panel/licenses/{{ lic.id }}/reset_hwid" method="post" style="display:inline">
<button class="btn btn-yellow btn-sm">ğŸ”„ HWID</button>
</form>

<form action="/panel/licenses/{{ lic.id }}/ban" method="post" style="display:inline">
<button class="btn btn-sm {% if lic.is_banned %}btn-green{% else %}btn-red{% endif %}">
{% if lic.is_banned %}âœ… Unban{% else %}ğŸš« Ban{% endif %}
</button>
</form>

{% if lic.abuse_score > 0 %}
<form action="/panel/licenses/{{ lic.id }}/reset_abuse" method="post" style="display:inline">
<button class="btn btn-purple btn-sm">ğŸ”§ Abuse</button>
</form>
{% endif %}

<form action="/panel/licenses/{{ lic.id }}/delete" method="post" style="display:inline" onsubmit="return confirm('Silmek istediÄŸinize emin misiniz?')">
<button class="btn btn-red btn-sm">ğŸ—‘ Sil</button>
</form>
</div>
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
</div>

<div id="tab-create" class="tab-content">
<div class="card">
<h3 style="margin-bottom:20px">â• Yeni Lisans OluÅŸtur</h3>
<form method="post" action="/panel/licenses/create">
<div class="form-group">
<label>SÃ¼re (gÃ¼n)</label>
<input name="duration_days" type="number" placeholder="Ã–rn: 30" required min="1">
</div>
<div class="form-group">
<label>Not (opsiyonel)</label>
<textarea name="note" placeholder="Ã–rn: Premium mÃ¼ÅŸteri - Discord: user#1234" rows="3"></textarea>
</div>
<button type="submit" class="btn btn-green">ğŸ”‘ Lisans OluÅŸtur</button>
</form>
</div>
</div>

<div id="tab-banned" class="tab-content">
<div class="card">
<h3 style="margin-bottom:20px">ğŸš« BanlÄ± HWID'ler - FarklÄ± PC Tespitleri</h3>
{% if banned_hwids %}
<div class="table-container">
<table>
<thead>
<tr>
<th>ID</th>
<th>HWID</th>
<th>LÄ°SANS KEY</th>
<th>NEDEN</th>
<th>Ã‡AKIÅAN HWID</th>
<th>KÄ°M BANLADI</th>
<th>BAN TARÄ°HÄ°</th>
<th>IP</th>
<th>DETAYLAR</th>
</tr>
</thead>
<tbody>
{% for ban in banned_hwids %}
<tr>
<td><strong>#{{ ban.id }}</strong></td>

<td>
<span class="code" title="{{ ban.hwid }}">{{ ban.hwid[:20] }}...</span>
<button class="btn btn-purple btn-sm" onclick="copyText('{{ ban.hwid }}')">ğŸ“‹</button>
</td>

<td>
<span class="code">{{ ban.license_key }}</span>
</td>

<td>
<span class="badge badge-red">{{ ban.reason }}</span>
</td>

<td>
{% if ban.conflicting_hwid %}
<span class="code" title="{{ ban.conflicting_hwid }}">{{ ban.conflicting_hwid[:20] }}...</span>
{% else %}
<span style="color:var(--text-dim)">-</span>
{% endif %}
</td>

<td>
{% if ban.banned_by == 'system' %}
<span class="badge badge-purple">ğŸ¤– SYSTEM</span>
{% else %}
<span class="badge badge-orange">ğŸ‘¤ {{ ban.banned_by }}</span>
{% endif %}
</td>

<td>
{{ ban.banned_at.strftime('%d.%m.%Y %H:%M:%S') }}
</td>

<td>
{% if ban.ip_address %}
<span class="code" style="font-size:11px">{{ ban.ip_address }}</span>
{% else %}
<span style="color:var(--text-dim)">-</span>
{% endif %}
</td>

<td>
{% if ban.details %}
<span style="font-size:11px;color:var(--text-dim)" title="{{ ban.details }}">{{ ban.details[:50] }}...</span>
{% else %}
<span style="color:var(--text-dim)">-</span>
{% endif %}
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
{% else %}
<p style="color:var(--text-dim);text-align:center;padding:40px">
ğŸ‰ HenÃ¼z banlÄ± HWID yok - Sistem temiz!
</p>
{% endif %}
</div>
</div>

<div id="tab-logs" class="tab-content">
<div class="card">
<h3 style="margin-bottom:20px">ğŸ“Š Son 20 Ä°ÅŸlem (Audit Log)</h3>
{% if recent_logs %}
{% for log in recent_logs %}
<div class="log-item">
<div>
<span class="log-action">{{ log.action }}</span>
{% if log.target %}
<span style="color:var(--text-dim)"> â€¢ </span>
<span class="code">{{ log.target }}</span>
{% endif %}
{% if log.details %}
<span style="color:var(--text-dim)"> â€¢ {{ log.details }}</span>
{% endif %}
<br>
<span style="font-size:11px;color:var(--text-dim)">
ğŸ‘¤ {{ log.user }} â€¢ ğŸŒ {{ log.ip_address }}
</span>
</div>
<div class="log-time">
{{ log.timestamp.strftime('%d.%m %H:%M:%S') }}
</div>
</div>
{% endfor %}
{% else %}
<p style="color:var(--text-dim);text-align:center;padding:40px">HenÃ¼z log kaydÄ± yok</p>
{% endif %}
</div>
</div>

<div id="timeModal" class="modal" onclick="if(event.target==this) closeTimeModal()">
<div class="modal-content">
<h3>â± SÃ¼re Ekle/Ã‡Ä±kar</h3>
<form method="post" action="/panel/licenses/add_time">
<input type="hidden" id="modalLicenseId" name="license_id">
<div class="form-group">
<label>Miktar</label>
<input name="amount" type="number" placeholder="Ã–rn: 7" required>
</div>
<div class="form-group">
<label>Birim</label>
<select name="unit">
<option value="hours">Saat</option>
<option value="days">GÃ¼n</option>
</select>
</div>
<div style="display:flex;gap:10px">
<button type="submit" class="btn btn-green">âœ… Ekle</button>
<button type="button" class="btn btn-red" onclick="closeTimeModal()">âŒ Ä°ptal</button>
</div>
</form>
</div>
</div>

</div>

<script>
function switchTab(tabName) {
document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
event.target.classList.add('active');
document.getElementById('tab-' + tabName).classList.add('active');
}

function copyText(text) {
navigator.clipboard.writeText(text).then(() => {
alert('âœ… KopyalandÄ±: ' + text);
});
}

function openTimeModal(licenseId) {
document.getElementById('modalLicenseId').value = licenseId;
document.getElementById('timeModal').style.display = 'flex';
}

function closeTimeModal() {
document.getElementById('timeModal').style.display = 'none';
}

document.getElementById('search').addEventListener('keyup', function() {
let query = this.value.toLowerCase();
document.querySelectorAll('#licenseTable tbody tr').forEach(row => {
row.style.display = row.innerText.toLowerCase().includes(query) ? '' : 'none';
});
});

setInterval(() => {
location.reload();
}, 10000);
</script>

</body>
</html>

